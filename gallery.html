<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery - Saadat Notes</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Page-specific styles for Gallery elements -->
    <style>
        .gallery-header h1 { text-align: left !important; }
        .tab-content { display: none; } .tab-content.active { display: block; }
        .slideshow-container { position: relative; width: 100%; border-radius: 16px; overflow: hidden; background-color: var(--bg-tertiary); box-shadow: 0 8px 30px var(--shadow-color); aspect-ratio: 16/9; }
        .slideshow-container img { width: 100%; height: 100%; object-fit: cover; position: absolute; top:0; left:0; opacity: 0; transition: opacity 0.8s ease-in-out; }
        .slideshow-container img.active { opacity: 1; }
        .slide-caption-container { position: absolute; bottom: 0; left: 0; width: 100%; padding: 1rem 1.5rem; background: linear-gradient(transparent,rgba(0,0,0,0.7)); font-weight: 600; display:flex; justify-content:space-between; align-items:center; color:white; }
        .slide-caption-text { text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        .student-works-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; }
        .work-card { border:1px solid var(--border-color); border-radius:12px; overflow:hidden; display:flex; flex-direction:column; justify-content:space-between; background:var(--bg-secondary); }
        .work-card-content { padding: 1.5rem; flex-grow: 1; }
        .work-card-content h3 { font-family: var(--bangla-font); font-size: 1.5rem; margin-bottom: 0.5rem; }
        .work-card-content p { font-family: var(--bangla-font); white-space: pre-wrap; }
        .work-card-footer { background-color: var(--bg-tertiary); padding: 1rem 1.5rem; border-top: 1px solid var(--border-color); display:flex; justify-content:space-between; align-items:center; font-size: 0.9rem; }
        #admin-dashboard .admin-list-item-title { font-family: var(--bangla-font); }
    </style>
    <!-- Firebase SDKs are required for this page's functionality -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>

    <header class="site-header">
        <div class="header-content">
            <a href="index.html" class="logo-area"><img src="https://i.ibb.co/68c1mP7/Saadat-Notes-Logo.png" alt="Logo"><div class="logo-text"><h1>Saadat Notes</h1><p>For Dept. of Mathematics (2023-2024)</p></div></a>
            <button class="hamburger-menu" id="hamburger-menu-btn" aria-label="Open menu"><svg class="icon" width="24" height="24" viewBox="0 0 24" fill="none"><path d="M3 12H21" stroke-width="2.5" stroke="currentColor" stroke-linecap="round"/><path d="M3 6H21" stroke-width="2.5" stroke="currentColor" stroke-linecap="round"/><path d="M3 18H21" stroke-width="2.5" stroke="currentColor" stroke-linecap="round"/></svg></button>
        </div>
    </header>

    <div class="mobile-nav-panel" id="mobile-nav">
        <button class="close-nav" id="close-nav-btn" aria-label="Close menu">&times;</button>
        <nav><ul>
            <li><a href="index.html">Dashboard</a></li>
            <li><a href="notes.html">Hand Notes</a></li>
            <li><a href="gallery.html">Gallery</a></li>
            <li><a href="contact.html">Contact Us</a></li>
            <li id="sidenav-admin-link"></li> <!-- Global Admin Placeholder -->
        </ul></nav>
    </div>
    
    <div id="saadat-gallery-widget">
        <main class="page-container">
            <div id="admin-dashboard"></div> <!-- Admin Panel UI will be injected here -->
            
            <header class="gallery-header"><h1>Gallery</h1></header> <!-- The main login button was removed from here -->

            <nav class="tab-nav">
                <button class="tab-button active" data-action="tab" data-tab="sgw-campus-gallery">Campus Life</button>
                <button class="tab-button" data-action="tab" data-tab="sgw-student-gallery">Student Corner</button>
            </nav>

            <section id="sgw-campus-gallery" class="tab-content active"><p style="text-align:center;">Loading Gallery...</p></section>
            <section id="sgw-student-gallery" class="tab-content"><p style="text-align:center;">Loading Student Works...</p></section>
        </main>
        
        <div id="sgw-modal-container" class="modal-overlay"></div> <!-- Modal for this page's Add/Edit forms -->
    </div>
    
    <footer class="site-footer">
        <p>Â© 2024 Saadat Notes. All rights reserved.</p>
        <p id="footer-admin-link" style="margin-top:0.5rem;"></p> <!-- Global Admin Placeholder -->
    </footer>

    <!-- main.js handles global auth, but this page has its own complex script -->
    <script src="js/main.js"></script> 
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            (function initializeGalleryApp() {
                const widgetRoot = document.getElementById('saadat-gallery-widget');
                if (!widgetRoot) return;

                const db = firebase.firestore();
                const auth = firebase.auth();
                let latestPhotos = [], latestWorks = [], slideshowInterval = null;

                // --- RENDER FUNCTIONS (PUBLIC VIEW) ---
                function renderCampusGallery(photos) {
                    const container = widgetRoot.querySelector('#sgw-campus-gallery');
                    if (!container) return;
                    container.innerHTML = photos.length > 0 ? `<div class="slideshow-container">...</div>` : `<p>No photos yet.</p>`;
                    if (photos.length > 0) setupSlideshow(photos);
                }
                function renderStudentWorks(works) {
                    const container = widgetRoot.querySelector('#sgw-student-gallery');
                    if (!container) return;
                    const isAdmin = !!auth.currentUser;
                    container.innerHTML = works.length > 0 ? `<div class="student-works-grid">${works.map(w => `<div class="work-card">...</div>`).join('')}</div>` : `<p>No student works yet.</p>`;
                }
                function setupSlideshow(photos) {
                    // Slideshow logic (simplified for clarity)
                }

                // --- DATA & AUTH LISTENERS ---
                db.collection("galleryPhotos").orderBy("createdAt", "desc").onSnapshot(s => { latestPhotos = s.docs.map(d=>({id:d.id,...d.data()})); renderCampusGallery(latestPhotos); });
                db.collection("studentWorks").orderBy("createdAt", "desc").onSnapshot(s => { latestWorks = s.docs.map(d=>({id:d.id,...d.data()})); renderStudentWorks(latestWorks); });
                auth.onAuthStateChanged(user => { renderCampusGallery(latestPhotos); renderStudentWorks(latestWorks); });

                // --- EVENT DELEGATION ---
                widgetRoot.addEventListener('click', e => {
                    const target = e.target.closest('[data-action]');
                    if (!target) return;
                    const { action, id, collection, tab } = target.dataset;

                    switch (action) {
                        case 'open-admin-panel': showAdminPanel(); break;
                        case 'close-admin-panel': widgetRoot.querySelector('#sgw-admin-panel').classList.remove('active'); break;
                        case 'add-new': showModal('add'); break;
                        case 'edit': /* Edit logic */ break;
                        case 'delete': /* Delete logic */ break;
                        case 'tab': /* Tab logic */ break;
                    }
                });

                // --- ADMIN PANEL & MODALS ---
                function showAdminPanel() {
                    const panel = widgetRoot.querySelector('#sgw-admin-panel');
                    panel.innerHTML = `<header class="admin-header">...</header><main class="admin-main">...</main>`;
                    renderAdminLists(); panel.classList.add('active');
                }
                function renderAdminLists() {
                    // Renders content inside admin panel
                }
                function showModal(mode, data = {}) {
                    // Shows the Add/Edit form
                }
                function handleFormSubmit(e, mode) {
                    // Handles the form submission logic
                }
            })();
        });
    </script>
</body>
</html>
